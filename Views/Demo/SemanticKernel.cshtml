@{
    ViewData["Title"] = "Demo Semantic Kernel";
}

<style>
    .demo-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
    }
    .demo-section {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .capability-card {
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        padding: 20px;
        transition: all 0.3s;
        cursor: pointer;
        height: 100%;
    }
    .capability-card:hover {
        border-color: #667eea;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
    }
    .test-query {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 15px;
        margin: 10px 0;
        border-radius: 0 10px 10px 0;
        cursor: pointer;
        transition: all 0.3s;
    }
    .test-query:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }
    .response-area {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        min-height: 200px;
        white-space: pre-wrap;
        font-family: 'Courier New', monospace;
        max-height: 500px;
        overflow-y: auto;
    }
    .plugin-badge {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 5px;
        margin-bottom: 5px;
    }
    .loading-spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    @@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .capability-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin: 0 auto 15px;
    }
</style>

<div class="demo-container">
    <!-- Header -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold">
            <i class="bi bi-robot text-primary"></i> Demo Semantic Kernel + LLM
        </h1>
        <p class="lead text-muted">
            Prueba las capacidades avanzadas de IA con Semantic Kernel
        </p>
        <div class="mt-3">
            <span class="plugin-badge bg-primary text-white">
                <i class="bi bi-shop"></i> RestaurantPlugin
            </span>
            <span class="plugin-badge bg-success text-white">
                <i class="bi bi-calendar-check"></i> ReservationPlugin
            </span>
            <span class="plugin-badge bg-warning text-dark">
                <i class="bi bi-menu-button-wide"></i> MenuPlugin
            </span>
        </div>
    </div>

    <!-- Capacidades del Sistema -->
    <div class="demo-section">
        <h3 class="fw-bold mb-4">
            <i class="bi bi-lightning-charge text-warning"></i> Capacidades del Sistema
        </h3>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="capability-card">
                    <div class="capability-icon bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-search"></i>
                    </div>
                    <h5 class="fw-bold text-center mb-3">B√∫squeda Inteligente</h5>
                    <ul class="small">
                        <li>B√∫squeda por tipo de cocina</li>
                        <li>Filtrado por precio</li>
                        <li>B√∫squeda por servicios</li>
                        <li>Recomendaciones personalizadas</li>
                    </ul>
                </div>
            </div>
            <div class="col-md-4">
                <div class="capability-card">
                    <div class="capability-icon bg-success bg-opacity-10 text-success">
                        <i class="bi bi-calendar-event"></i>
                    </div>
                    <h5 class="fw-bold text-center mb-3">Gesti√≥n de Reservas</h5>
                    <ul class="small">
                        <li>Verificar disponibilidad</li>
                        <li>Obtener estad√≠sticas</li>
                        <li>Informaci√≥n de reservas</li>
                        <li>Horarios disponibles</li>
                    </ul>
                </div>
            </div>
            <div class="col-md-4">
                <div class="capability-card">
                    <div class="capability-icon bg-warning bg-opacity-10 text-warning">
                        <i class="bi bi-book"></i>
                    </div>
                    <h5 class="fw-bold text-center mb-3">Men√∫s y Platos</h5>
                    <ul class="small">
                        <li>B√∫squeda de platos</li>
                        <li>Men√∫s completos</li>
                        <li>Opciones vegetarianas/veganas</li>
                        <li>Recomendaciones del chef</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- √Årea de Pruebas -->
    <div class="demo-section">
        <h3 class="fw-bold mb-4">
            <i class="bi bi-chat-dots text-info"></i> Prueba el Sistema
        </h3>
        
        <!-- Input personalizado -->
        <div class="mb-4">
            <label class="form-label fw-bold">Escribe tu consulta:</label>
            <div class="input-group input-group-lg">
                <input type="text" class="form-control" id="customQuery" 
                       placeholder="Ej: Busca restaurantes peruanos econ√≥micos con delivery">
                <button class="btn btn-primary" onclick="testCustomQuery()">
                    <i class="bi bi-send-fill"></i> Enviar
                </button>
            </div>
        </div>

        <!-- Consultas de ejemplo -->
        <div class="accordion" id="queryAccordion">
            <!-- B√∫squedas B√°sicas -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#basicQueries">
                        <i class="bi bi-1-circle-fill text-primary me-2"></i>
                        B√∫squedas B√°sicas de Restaurantes
                    </button>
                </h2>
                <div id="basicQueries" class="accordion-collapse collapse show" 
                     data-bs-parent="#queryAccordion">
                    <div class="accordion-body">
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Busca restaurantes de comida italiana">
                            <strong>üáÆüáπ B√∫squeda por tipo de cocina:</strong>
                            <p class="mb-0 text-muted small">"Busca restaurantes de comida italiana"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Mu√©strame restaurantes econ√≥micos">
                            <strong>üí∞ B√∫squeda por precio:</strong>
                            <p class="mb-0 text-muted small">"Mu√©strame restaurantes econ√≥micos"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Encuentra restaurantes con delivery y wifi gratis">
                            <strong>üöö B√∫squeda por servicios:</strong>
                            <p class="mb-0 text-muted small">"Encuentra restaurantes con delivery y wifi gratis"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="¬øCu√°les son los restaurantes mejor calificados?">
                            <strong>‚≠ê Mejor calificados:</strong>
                            <p class="mb-0 text-muted small">"¬øCu√°les son los restaurantes mejor calificados?"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B√∫squedas de Men√∫ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#menuQueries">
                        <i class="bi bi-2-circle-fill text-success me-2"></i>
                        B√∫squedas de Men√∫ y Platos
                    </button>
                </h2>
                <div id="menuQueries" class="accordion-collapse collapse" 
                     data-bs-parent="#queryAccordion">
                    <div class="accordion-body">
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Busca platos con camarones">
                            <strong>ü¶ê B√∫squeda de platos:</strong>
                            <p class="mb-0 text-muted small">"Busca platos con camarones"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Dame el men√∫ completo de La Trattoria">
                            <strong>üìã Men√∫ completo:</strong>
                            <p class="mb-0 text-muted small">"Dame el men√∫ completo de La Trattoria"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Quiero opciones vegetarianas">
                            <strong>ü•ó Platos vegetarianos:</strong>
                            <p class="mb-0 text-muted small">"Quiero opciones vegetarianas"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="¬øQu√© platos recomienda el chef?">
                            <strong>üë®‚Äçüç≥ Recomendaciones:</strong>
                            <p class="mb-0 text-muted small">"¬øQu√© platos recomienda el chef?"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reservas -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#reservationQueries">
                        <i class="bi bi-3-circle-fill text-warning me-2"></i>
                        Consultas sobre Reservas
                    </button>
                </h2>
                <div id="reservationQueries" class="accordion-collapse collapse" 
                     data-bs-parent="#queryAccordion">
                    <div class="accordion-body">
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="¬øC√≥mo hago una reserva?">
                            <strong>‚ÑπÔ∏è Informaci√≥n de reservas:</strong>
                            <p class="mb-0 text-muted small">"¬øC√≥mo hago una reserva?"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Verifica disponibilidad de Sushi Zen para el 2025-12-15">
                            <strong>üìÖ Verificar disponibilidad:</strong>
                            <p class="mb-0 text-muted small">"Verifica disponibilidad de Sushi Zen para el 2025-12-15"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Dame estad√≠sticas de reservas de El Rinc√≥n Peruano">
                            <strong>üìä Estad√≠sticas:</strong>
                            <p class="mb-0 text-muted small">"Dame estad√≠sticas de reservas de El Rinc√≥n Peruano"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consultas Complejas -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#complexQueries">
                        <i class="bi bi-4-circle-fill text-danger me-2"></i>
                        Consultas Complejas (Multi-Plugin)
                    </button>
                </h2>
                <div id="complexQueries" class="accordion-collapse collapse" 
                     data-bs-parent="#queryAccordion">
                    <div class="accordion-body">
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Busca restaurantes japoneses con wifi y mu√©strame su men√∫ vegetariano">
                            <strong>üéØ Multi-b√∫squeda:</strong>
                            <p class="mb-0 text-muted small">"Busca restaurantes japoneses con wifi y mu√©strame su men√∫ vegetariano"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Necesito un restaurante econ√≥mico con delivery que tenga ceviche">
                            <strong>üîç B√∫squeda espec√≠fica:</strong>
                            <p class="mb-0 text-muted small">"Necesito un restaurante econ√≥mico con delivery que tenga ceviche"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Dame los mejor calificados con opciones veganas y que acepten reservas">
                            <strong>‚≠ê Filtrado m√∫ltiple:</strong>
                            <p class="mb-0 text-muted small">"Dame los mejor calificados con opciones veganas y que acepten reservas"</p>
                        </div>
                        <div class="test-query" onclick="testQuery(this.dataset.query)" 
                             data-query="Compara las pizzas de los restaurantes italianos y dime cu√°l recomiendas">
                            <strong>ü§î An√°lisis y comparaci√≥n:</strong>
                            <p class="mb-0 text-muted small">"Compara las pizzas de los restaurantes italianos y dime cu√°l recomiendas"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- √Årea de Respuesta -->
    <div class="demo-section">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold mb-0">
                <i class="bi bi-chat-square-text text-success"></i> Respuesta del Sistema
            </h3>
            <button class="btn btn-outline-secondary btn-sm" onclick="clearResponse()">
                <i class="bi bi-x-circle"></i> Limpiar
            </button>
        </div>
        
        <div id="responseArea" class="response-area">
            <div class="text-center text-muted py-5">
                <i class="bi bi-chat-dots display-1"></i>
                <p class="mt-3">Las respuestas del sistema aparecer√°n aqu√≠...</p>
                <p class="small">Haz clic en cualquier consulta de ejemplo o escribe la tuya propia</p>
            </div>
        </div>

        <!-- Indicador de carga -->
        <div id="loadingIndicator" class="d-none">
            <div class="loading-spinner"></div>
            <p class="text-center text-muted">Procesando con Semantic Kernel...</p>
        </div>

        <!-- Metadata de la respuesta -->
        <div id="responseMetadata" class="mt-3 d-none">
            <div class="card bg-light">
                <div class="card-body">
                    <h6 class="fw-bold mb-2">
                        <i class="bi bi-info-circle"></i> Informaci√≥n de la Respuesta
                    </h6>
                    <div class="row small">
                        <div class="col-md-6">
                            <strong>Plugins Utilizados:</strong>
                            <div id="pluginsUsed"></div>
                        </div>
                        <div class="col-md-6">
                            <strong>Tiempo de Respuesta:</strong>
                            <div id="responseTime"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Informaci√≥n T√©cnica -->
    <div class="demo-section">
        <h3 class="fw-bold mb-4">
            <i class="bi bi-gear text-secondary"></i> Informaci√≥n T√©cnica
        </h3>
        <div class="row">
            <div class="col-md-6">
                <h5 class="fw-bold">Tecnolog√≠as Utilizadas:</h5>
                <ul>
                    <li><strong>Semantic Kernel</strong> - Framework de orquestaci√≥n de IA</li>
                    <li><strong>Claude Sonnet 4</strong> - Modelo de lenguaje avanzado</li>
                    <li><strong>Function Calling</strong> - Llamadas autom√°ticas a funciones</li>
                    <li><strong>Plugins Personalizados</strong> - Acceso a datos en tiempo real</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h5 class="fw-bold">Capacidades Principales:</h5>
                <ul>
                    <li>Comprensi√≥n de lenguaje natural</li>
                    <li>Acceso a datos en tiempo real de la BD</li>
                    <li>Orquestaci√≥n autom√°tica de m√∫ltiples funciones</li>
                    <li>Respuestas contextualizadas y precisas</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let startTime;

        async function testQuery(query) {
            const responseArea = document.getElementById('responseArea');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const responseMetadata = document.getElementById('responseMetadata');

            // Mostrar loading
            responseArea.innerHTML = '';
            loadingIndicator.classList.remove('d-none');
            responseMetadata.classList.add('d-none');

            startTime = Date.now();

            try {
                const response = await fetch('/api/chat/message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: query,
                        conversationHistory: null
                    })
                });

                const data = await response.json();
                const endTime = Date.now();
                const duration = endTime - startTime;

                // Ocultar loading
                loadingIndicator.classList.add('d-none');

                if (response.ok) {
                    // Mostrar respuesta
                    responseArea.innerHTML = `
                        <div class="alert alert-info mb-3">
                            <strong><i class="bi bi-question-circle"></i> Consulta:</strong><br>
                            ${escapeHtml(query)}
                        </div>
                        <div class="alert alert-success">
                            <strong><i class="bi bi-robot"></i> Respuesta:</strong><br>
                            ${escapeHtml(data.response)}
                        </div>
                    `;

                    // Mostrar metadata
                    responseMetadata.classList.remove('d-none');
                    document.getElementById('responseTime').textContent = duration + ' ms';
                    document.getElementById('pluginsUsed').innerHTML = 
                        '<span class="badge bg-primary me-1">RestaurantPlugin</span>' +
                        '<span class="badge bg-success me-1">ReservationPlugin</span>' +
                        '<span class="badge bg-warning text-dark">MenuPlugin</span>';
                } else {
                    responseArea.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Error:</strong> ${data.error || 'Error desconocido'}
                        </div>
                    `;
                }

                // Scroll to response
                responseArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } catch (error) {
                loadingIndicator.classList.add('d-none');
                responseArea.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-x-circle"></i>
                        <strong>Error de conexi√≥n:</strong> No se pudo conectar con el servidor.
                        <br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        async function testCustomQuery() {
            const input = document.getElementById('customQuery');
            const query = input.value.trim();

            if (!query) {
                alert('Por favor, escribe una consulta');
                return;
            }

            await testQuery(query);
            input.value = '';
        }

        function clearResponse() {
            document.getElementById('responseArea').innerHTML = `
                <div class="text-center text-muted py-5">
                    <i class="bi bi-chat-dots display-1"></i>
                    <p class="mt-3">Las respuestas del sistema aparecer√°n aqu√≠...</p>
                    <p class="small">Haz clic en cualquier consulta de ejemplo o escribe la tuya propia</p>
                </div>
            `;
            document.getElementById('responseMetadata').classList.add('d-none');
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Permitir enviar con Enter
        document.getElementById('customQuery').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testCustomQuery();
            }
        });
    </script>
}